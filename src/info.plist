<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>bundleid</key>
	<string>com.ay.pdf-actions</string>
	<key>category</key>
	<string>ay</string>
	<key>connections</key>
	<dict>
		<key>0086D593-FEE0-4B94-B072-75E409655B5C</key>
		<array>
			<dict>
				<key>destinationuid</key>
				<string>5E4A8EDA-34CF-4E5D-B8A7-811B00A9A0A5</string>
				<key>modifiers</key>
				<integer>0</integer>
				<key>modifiersubtext</key>
				<string></string>
				<key>vitoclose</key>
				<false/>
			</dict>
		</array>
		<key>7C7F0602-B9F2-4FFA-870C-CEA945590CF4</key>
		<array>
			<dict>
				<key>destinationuid</key>
				<string>FBEABCC0-4BD5-41D2-87F3-2075412017E2</string>
				<key>modifiers</key>
				<integer>0</integer>
				<key>modifiersubtext</key>
				<string></string>
				<key>vitoclose</key>
				<false/>
			</dict>
		</array>
		<key>FBEABCC0-4BD5-41D2-87F3-2075412017E2</key>
		<array>
			<dict>
				<key>destinationuid</key>
				<string>0086D593-FEE0-4B94-B072-75E409655B5C</string>
				<key>modifiers</key>
				<integer>0</integer>
				<key>modifiersubtext</key>
				<string></string>
				<key>vitoclose</key>
				<false/>
			</dict>
		</array>
	</dict>
	<key>createdby</key>
	<string>ay</string>
	<key>description</key>
	<string>some commonly used pdf operations</string>
	<key>disabled</key>
	<false/>
	<key>name</key>
	<string>PDF-Actions</string>
	<key>objects</key>
	<array>
		<dict>
			<key>config</key>
			<dict>
				<key>concurrently</key>
				<false/>
				<key>escaping</key>
				<integer>102</integer>
				<key>script</key>
				<string>#!/bin/zsh

# 检查 ImageMagick 是否安装
if ! command -v magick &amp;&gt;/dev/null; then
    # 发送 macOS 通知
    osascript -e 'display notification "未检测到 ImageMagick，请安装后再运行。" with title "转换失败"'
    echo "错误：未检测到 ImageMagick (magick) 命令，请安装后再运行。" &gt;&amp;2
    exit 1
fi

# 初始化一个数组来存储输出文件路径
output_files=()

# 遍历 Alfred 传递的文件
for FILE in "$@"
do
    # 定义输出文件名
    OUTPUT="${FILE%.*}.png"

    # 使用 ImageMagick 转换文件
    if magick -density 300 "$FILE" "$OUTPUT"; then
        # 记录成功转换的文件
        output_files+=("$OUTPUT")
    else
        # 发送失败通知
        osascript -e 'display notification "文件转换失败：" &amp; "'"$FILE"'" with title "转换错误"'
        echo "错误：转换文件 $FILE 失败。" &gt;&amp;2
    fi
done

# 如果转换成功，发送成功通知
if [ ${#output_files[@]} -gt 0 ]; then
    osascript -e 'display notification "文件转换完成。" with title "转换成功"'
fi</string>
				<key>scriptargtype</key>
				<integer>1</integer>
				<key>scriptfile</key>
				<string></string>
				<key>type</key>
				<integer>5</integer>
			</dict>
			<key>type</key>
			<string>alfred.workflow.action.script</string>
			<key>uid</key>
			<string>A10346B0-9E3B-4CEB-92E3-85839F5F8ABB</string>
			<key>version</key>
			<integer>2</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>concurrently</key>
				<false/>
				<key>escaping</key>
				<integer>102</integer>
				<key>script</key>
				<string>#!/bin/zsh
export PATH=$PATH:/Library/TeX/texbin

# Check if pdfcrop is installed
if ! command -v /Library/TeX/texbin/pdfcrop &amp;&gt; /dev/null
then
    osascript -e 'display dialog "pdfcrop is not installed. Please install it using Homebrew." buttons {"OK"} default button "OK" with icon caution'
    exit 1
fi

# Loop through each file provided by Alfred
for FILE in "$@"
do
    # Define the output file name
    OUTPUT="${FILE%.*}_cropped.pdf"

    # Run pdfcrop
    /Library/TeX/texbin/pdfcrop "$FILE" "$FILE"

    # Notify user of success with the file path
    osascript -e 'display notification "PDF cropped successfully! Output file: '"$OUTPUT"'" with title "PDF Crop Completed"'
done

# Provide the paths to the cropped files as output
echo "$@"</string>
				<key>scriptargtype</key>
				<integer>1</integer>
				<key>scriptfile</key>
				<string></string>
				<key>type</key>
				<integer>5</integer>
			</dict>
			<key>type</key>
			<string>alfred.workflow.action.script</string>
			<key>uid</key>
			<string>FFB96DC5-AA68-4BEB-A99C-709883837802</string>
			<key>version</key>
			<integer>2</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>acceptsfiles</key>
				<true/>
				<key>acceptsmulti</key>
				<integer>1</integer>
				<key>acceptstext</key>
				<false/>
				<key>acceptsurls</key>
				<false/>
				<key>name</key>
				<string>PDF Actions</string>
			</dict>
			<key>type</key>
			<string>alfred.workflow.trigger.universalaction</string>
			<key>uid</key>
			<string>7C7F0602-B9F2-4FFA-870C-CEA945590CF4</string>
			<key>version</key>
			<integer>1</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>concurrently</key>
				<false/>
				<key>escaping</key>
				<integer>102</integer>
				<key>script</key>
				<string>/opt/homebrew/anaconda3/bin/python main.py --mode process --operation {query}</string>
				<key>scriptargtype</key>
				<integer>0</integer>
				<key>scriptfile</key>
				<string></string>
				<key>type</key>
				<integer>11</integer>
			</dict>
			<key>type</key>
			<string>alfred.workflow.action.script</string>
			<key>uid</key>
			<string>5E4A8EDA-34CF-4E5D-B8A7-811B00A9A0A5</string>
			<key>version</key>
			<integer>2</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>alfredfiltersresults</key>
				<false/>
				<key>alfredfiltersresultsmatchmode</key>
				<integer>0</integer>
				<key>argumenttreatemptyqueryasnil</key>
				<true/>
				<key>argumenttrimmode</key>
				<integer>0</integer>
				<key>argumenttype</key>
				<integer>1</integer>
				<key>escaping</key>
				<integer>102</integer>
				<key>queuedelaycustom</key>
				<integer>3</integer>
				<key>queuedelayimmediatelyinitially</key>
				<true/>
				<key>queuedelaymode</key>
				<integer>0</integer>
				<key>queuemode</key>
				<integer>1</integer>
				<key>runningsubtext</key>
				<string></string>
				<key>script</key>
				<string>/opt/homebrew/anaconda3/bin/python main.py --mode list --query "{query}"</string>
				<key>scriptargtype</key>
				<integer>0</integer>
				<key>scriptfile</key>
				<string></string>
				<key>subtext</key>
				<string></string>
				<key>title</key>
				<string></string>
				<key>type</key>
				<integer>11</integer>
				<key>withspace</key>
				<false/>
			</dict>
			<key>type</key>
			<string>alfred.workflow.input.scriptfilter</string>
			<key>uid</key>
			<string>0086D593-FEE0-4B94-B072-75E409655B5C</string>
			<key>version</key>
			<integer>3</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>argument</key>
				<string></string>
				<key>passthroughargument</key>
				<false/>
				<key>variables</key>
				<dict>
					<key>files</key>
					<string>{query}</string>
				</dict>
			</dict>
			<key>type</key>
			<string>alfred.workflow.utility.argument</string>
			<key>uid</key>
			<string>FBEABCC0-4BD5-41D2-87F3-2075412017E2</string>
			<key>version</key>
			<integer>1</integer>
		</dict>
	</array>
	<key>readme</key>
	<string># Alfred PDF Operations Workflow

一个用于对 PDF 文件执行常用操作的 Alfred Workflow。


Created by [zzkkyys](https://github.com/zzkkyys) | [Github](https://github.com/zzkkyys/Alfred-PDF-Operations) 




## 功能

通过 Finder 选中 PDF 文件后，使用 Universal Action 可以执行以下操作：

1. **PDF 转 PNG 图片** - 将 PDF 的每一页转换为 PNG 图片（300 DPI）
2. **裁剪 PDF 边缘空白** - 自动检测并裁剪 PDF 页面的空白边距
3. **拆分 PDF 为单页** - 将 PDF 文件拆分为多个单页 PDF 文件



## 依赖项

### Python 包

```bash
pip3 install PyMuPDF pdf2image pillow
```

### 系统工具

使用 Homebrew 安装必要的命令行工具：

```bash
# PDF转PNG所需 (poppler提供pdftoppm)
brew install poppler

# PDF裁剪所需 (可选择其一)
# 方案1: 完整的TeX Live (较大，约7GB)
brew install texlive

# 方案2: 轻量级的BasicTeX (推荐，约100MB)
brew install basictex
# 安装后需要更新PATH
eval "$(/usr/libexec/path_helper)"
```

**注意**: `pdfcrop` 工具需要 TeX Live 或 BasicTeX。如果只需要 PDF 转 PNG 和拆分功能，可以不安装。

## 使用方法

### 通过 Universal Action

1. 在 Finder 中选中一个或多个 PDF 文件
2. 按下 Universal Action 快捷键（默认是 `⌘ + ⇧ + A`）
3. 选择 "PDF Operations"
4. 选择要执行的操作
5. 处理后的文件将保存在与原文件相同的目录中

### 输出说明

- **PDF 转 PNG**: 
  - 单页 PDF：生成 `原文件名.png`
  - 多页 PDF：生成 `原文件名_page_1.png`, `原文件名_page_2.png` 等

- **裁剪 PDF 边缘空白**: 
  - 生成 `原文件名_cropped.pdf`

- **拆分 PDF 为单页**: 
  - 在原文件目录下创建 `原文件名_pages` 文件夹
  - 生成 `原文件名_page_001.pdf`, `原文件名_page_002.pdf` 等


## 扩展

要添加新的 PDF 操作：

1. 在 `pdf_processors/` 目录下创建新的处理器类，继承 `BaseProcessor`
2. 实现 `process_single()` 方法
3. 在 `main.py` 的 `PDF_OPERATIONS` 字典中添加新操作
4. 在 `pdf_processors/__init__.py` 中导出新处理器
4. Use `⌘ + L` to preview search results
5. Press `Enter` to open file in Obsidian</string>
	<key>uidata</key>
	<dict>
		<key>0086D593-FEE0-4B94-B072-75E409655B5C</key>
		<dict>
			<key>xpos</key>
			<integer>415</integer>
			<key>ypos</key>
			<integer>325</integer>
		</dict>
		<key>5E4A8EDA-34CF-4E5D-B8A7-811B00A9A0A5</key>
		<dict>
			<key>xpos</key>
			<integer>595</integer>
			<key>ypos</key>
			<integer>325</integer>
		</dict>
		<key>7C7F0602-B9F2-4FFA-870C-CEA945590CF4</key>
		<dict>
			<key>note</key>
			<string>Don't forget to hint to Alfred not to close in the connection config</string>
			<key>xpos</key>
			<integer>85</integer>
			<key>ypos</key>
			<integer>315</integer>
		</dict>
		<key>A10346B0-9E3B-4CEB-92E3-85839F5F8ABB</key>
		<dict>
			<key>note</key>
			<string>convert pdf to png</string>
			<key>xpos</key>
			<integer>695</integer>
			<key>ypos</key>
			<integer>70</integer>
		</dict>
		<key>FBEABCC0-4BD5-41D2-87F3-2075412017E2</key>
		<dict>
			<key>xpos</key>
			<integer>315</integer>
			<key>ypos</key>
			<integer>355</integer>
		</dict>
		<key>FFB96DC5-AA68-4BEB-A99C-709883837802</key>
		<dict>
			<key>xpos</key>
			<integer>845</integer>
			<key>ypos</key>
			<integer>75</integer>
		</dict>
	</dict>
	<key>userconfigurationconfig</key>
	<array/>
	<key>variablesdontexport</key>
	<array/>
	<key>version</key>
	<string>1.0</string>
	<key>webaddress</key>
	<string>https://www.alfredapp.com</string>
</dict>
</plist>
